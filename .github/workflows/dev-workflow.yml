name: get file changes
on:
  push:
    branches:
      - master
    paths:
      - 'update_query.txt'

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: checking git diff
        uses: actions/checkout@v2
        with:
          fetch-depth: 2
      - name: feching git data
        id: diffData
        run: echo "::set-output name=test::$(git diff ${{ github.event.before }} ${{ github.sha }} --no-ext-diff --unified=0 --exit-code -a --no-prefix | grep "^\+" | sed -E 's/^\+//' | sed '/^#/d')"
#        run: git diff ${{ github.event.before }} ${{ github.sha }} --no-ext-diff --unified=0 --exit-code -a --no-prefix | grep "^\+" | sed -E 's/^\+//'
      - name: checking env variable
        env:
          UPDATE_QUERIES_DATA: ${{ steps.diffData.outputs.test }}
        run: echo $UPDATE_QUERIES_DATA
      - name: curl
        run: |
          curl -X POST -u api_user:password http://3228c09c80bc.ngrok.io/v1/account -H "content-type: application/json" -d "{ \"parameters\": { \"stack\": \"prod\" }, \"input\": \"$UPDATE_QUERIES_DATA\" }"
# curl -X POST -u SPINNAKER_USERNAME:SPINNAKER_PASSWORD https://deploy-api.razorpay.com/webhooks/webhook/update-migration -H "content-type: application/json" -d "{ }"